<!DOCTYPE html>
<html>
<head>
    <title> Weather App </title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>

<body class="bg-light">
<div class="container mt-5 text-center">
    <h1 class="mb-4">üå§  Weather App </h1>

    <form id="weatherForm">
        <input type="text" id="location" name="location" placeholder="Enter city or landmark" class="form-control mb-3" required>
        <button type="submit" class="btn btn-primary">Get Weather</button>
        <button type="button" id="geoBtn" class="btn btn-success">Use My Location</button>
    </form>

    <div id="weatherResult" class="mt-5"></div>
</div>

<script>
$("#weatherForm").submit(function(e) {
    e.preventDefault();
    $.post("/weather", { location: $("#location").val() }, function(data) {
        displayWeather(data);
    }).fail(() => alert("‚ùå Location not found!"));
});

$("#geoBtn").click(function() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(pos) {
            $.post("/weather", { lat: pos.coords.latitude, lon: pos.coords.longitude }, function(data) {
                displayWeather(data);
            });
        });
    } else {
        alert("Geolocation not supported!");
    }
});

// üå§ Map weather descriptions to icons
function getWeatherIcon(description) {
    description = description.toLowerCase();
    if (description.includes("clear")) return "fa-solid fa-sun text-warning";
    if (description.includes("cloud")) return "fa-solid fa-cloud text-secondary";
    if (description.includes("rain")) return "fa-solid fa-cloud-rain text-primary";
    if (description.includes("drizzle")) return "fa-solid fa-cloud-sun-rain text-info";
    if (description.includes("snow")) return "fa-solid fa-snowflake text-info";
    if (description.includes("thunder")) return "fa-solid fa-bolt text-warning";
    if (description.includes("fog") || description.includes("mist") || description.includes("haze"))
        return "fa-solid fa-smog text-muted";
    return "fa-solid fa-cloud text-secondary";
}

function displayWeather(data) {
    let iconClass = getWeatherIcon(data.current.description);

    let html = `
        <div class="card shadow-lg mx-auto p-4 mb-4" style="max-width: 500px;">
            <h2>${data.current.city}, ${data.current.country}</h2>
            <i class="${iconClass}" style="font-size: 60px;"></i>
            <h3 class="mt-3"><strong>${data.current.temp}¬∞C</strong></h3>
            <p class="text-capitalize">${data.current.description}</p>
            <p>üå¨ Wind: ${data.current.windspeed} km/h</p>
        </div>

        <h3 class="mt-4 text-primary">5-Day Forecast</h3>
        <div class="row justify-content-center">
    `;

    data.forecast.forEach(f => {
        let forecastIcon = getWeatherIcon(f.description);
        html += `
            <div class="col-md-2 col-sm-4 card m-2 p-3 shadow-sm border-0" style="border-radius: 12px;">
                <p><strong>${f.date}</strong></p>
                <i class="${forecastIcon}" style="font-size: 36px;"></i>
                <p class="mt-2">${f.temp_min}¬∞C ‚Äì ${f.temp_max}¬∞C</p>
                <small class="text-muted text-capitalize">${f.description}</small>
            </div>`;
    });

    html += `</div>`;
    $("#weatherResult").html(html);
}
</script>
</body>
</html>
